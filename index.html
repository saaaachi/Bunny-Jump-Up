<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bunny Jump Up - v2</title>
    <style>
        body { margin: 0; overflow: hidden; background: #fff9c4; font-family: sans-serif; touch-action: none; }
        #ad-top, #ad-bottom { position: fixed; left: 0; width: 100%; height: 150px; background: #333; z-index: 100; display: flex; align-items: center; justify-content: center; }
        #ad-top { top: 0; } #ad-bottom { bottom: 0; }
        iframe { border: none; width: 100%; height: 150px; }
        canvas { display: block; margin-top: 150px; background: #fffde7; }
        #ui { position: absolute; top: 160px; left: 0; width: 100%; text-align: center; color: #f57f17; font-size: 26px; font-weight: bold; pointer-events: none; z-index: 10; text-shadow: 1px 1px 0px white; }
        #startScreen { position: absolute; top: 150px; left: 0; width: 100%; height: calc(100vh - 300px); background: rgba(255,255,255,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; }
        #goButton { padding: 15px 45px; font-size: 24px; background: #ff9800; border: none; border-radius: 50px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px #e65100; }
    </style>
</head>
<body>
    <div id="ad-top"><iframe id="frame-top" src="ad.html"></iframe></div>
    <div id="ad-bottom"><iframe id="frame-bottom" src="ad.html"></iframe></div>
    
    <div id="startScreen">
        <h1 style="color:#ff9800; margin-bottom: 5px;">Bunny Jump Up</h1>
        <p style="text-align: center; line-height: 1.5;">å·¦å³ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼<br>ã©ã‚“ã©ã‚“é«˜ãç™»ã£ã¦ã„ã“ã†ï¼ğŸ°ğŸ¥•</p>
        <button id="goButton">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        <p id="best-info" style="margin-top:15px; font-weight:bold; color:#f57f17;">BEST: <span id="best-ui">0</span></p>
    </div>

    <div id="ui">SCORE: 0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const ui = document.getElementById("ui");
        const startScreen = document.getElementById("startScreen");
        const bestUi = document.getElementById("best-ui");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - 300;

        let score = 0;
        let bestScore = localStorage.getItem("bunny_jump_best") || 0;
        let gameActive = false;
        let player = { x: canvas.width/2, y: canvas.height - 100, vy: 0, size: 40 };
        let platforms = [];
        let cameraY = 0;
        bestUi.innerText = bestScore;

        function initGame() {
            cameraY = 0;
            platforms = [];
            // æœ€åˆã®è¶³å ´ï¼ˆå¿…ãšè¶³å…ƒã«ã‚ã‚‹ã‚ˆã†ã«ï¼‰
            platforms.push({ x: canvas.width/2 - 50, y: canvas.height - 50, w: 100 });
            // åˆæœŸè¶³å ´ã‚’ä¸Šã«ç©ã¿ä¸Šã’ã‚‹
            for(let i=1; i<10; i++) {
                addPlatform(canvas.height - (i * 120));
            }
        }

        function addPlatform(y) {
            platforms.push({
                x: Math.random() * (canvas.width - 80),
                y: y,
                w: 80
            });
        }

        document.getElementById("goButton").onclick = () => {
            startScreen.style.display = "none";
            gameActive = true;
            score = 0;
            player.x = canvas.width/2;
            player.y = canvas.height - 100;
            player.vy = -12; // åˆå‹•ã‚¸ãƒ£ãƒ³ãƒ—
            initGame();
            update();
        };

        window.addEventListener("touchstart", (e) => {
            if(!gameActive) return;
            const touchX = e.touches[0].clientX;
            // æ¨ªç§»å‹•
            if(touchX < canvas.width/2) player.x -= 35;
            else player.x += 35;
            e.preventDefault();
        }, {passive: false});

        function update() {
            if(!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            player.vy += 0.4; // é‡åŠ›
            player.y += player.vy;

            // ã‚«ãƒ¡ãƒ©è¿½å¾“ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç”»é¢ä¸­å¤®ã‚ˆã‚Šä¸Šã«ã„ã£ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            if (player.y < cameraY + canvas.height / 2) {
                let diff = (cameraY + canvas.height / 2) - player.y;
                cameraY -= diff;
                // è¶³å ´ãŒè¶³ã‚Šãªããªã£ãŸã‚‰è£œå……
                if (platforms[platforms.length - 1].y > cameraY - 100) {
                    addPlatform(platforms[platforms.length - 1].y - 120);
                }
            }

            // è¶³å ´æç”»ã¨åˆ¤å®š
            ctx.fillStyle = "#8bc34a";
            platforms.forEach((p, index) => {
                let drawY = p.y - cameraY;
                ctx.fillRect(p.x, drawY, p.w, 15);

                // ç€åœ°åˆ¤å®šï¼ˆä¸‹é™ä¸­ã®ã¿ï¼‰
                if (player.vy > 0 && 
                    player.x > p.x - 20 && player.x < p.x + p.w + 20 &&
                    player.y > p.y - 10 && player.y < p.y + 15) {
                    player.vy = -13; // è·³ã­è¿”ã‚Š
                    // ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ˆç™»ã£ãŸé«˜ã•ã«å¿œã˜ã¦ï¼‰
                    let currentScore = Math.floor((canvas.height - p.y) / 10);
                    if (currentScore > score) {
                        score = currentScore;
                        ui.innerText = "SCORE: " + score;
                    }
                }
            });

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»
            ctx.font = "50px Arial";
            ctx.textAlign = "center";
            ctx.fillText("ğŸ°", player.x, player.y - cameraY);

            // ç”»é¢å¤–ï¼ˆè½ä¸‹ï¼‰åˆ¤å®š
            if (player.y - cameraY > canvas.height + 100) {
                gameOver();
                return;
            }

            // å·¦å³ãƒ«ãƒ¼ãƒ—
            if (player.x < 0) player.x = canvas.width;
            if (player.x > canvas.width) player.x = 0;

            requestAnimationFrame(update);
        }

        function gameOver() {
            gameActive = false;
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem("bunny_jump_best", bestScore);
            }
            alert("è½ã£ã“ã¡ã¡ã‚ƒã£ãŸï¼\nSCORE: " + score);
            location.reload();
        }

        // ğŸš€ 30ç§’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ¨™æº–è£…å‚™ï¼ï¼‰
        setInterval(() => {
            ["frame-top", "frame-bottom"].forEach(id => {
                const f = document.getElementById(id);
                if(f) {
                    const s = f.src; f.src = "about:blank";
                    setTimeout(() => f.src = s, 100);
                }
            });
        }, 30000);
    </script>
</body>
</html>
