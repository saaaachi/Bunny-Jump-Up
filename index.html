<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bunny Jump Up - v26.8</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #fff9c4; font-family: sans-serif; touch-action: none; position: fixed; width: 100%; height: 100%; }
        
        /* Â∫ÉÂëäÊû†Ôºö150px */
        #ad-top, #ad-bottom { width: 100%; height: 150px; background: #333; display: flex; align-items: center; justify-content: center; flex-shrink: 0; z-index: 1000; position: relative; }
        iframe { border: none; width: 100%; height: 100%; background: #333; }

        /* „Ç≤„Éº„É†„Ç®„É™„Ç¢ */
        #game-outer {
            flex-grow: 1; position: relative; width: 100%;
            background: #fffde7; overflow: hidden; z-index: 10;
            border-bottom: 5px solid #f57f17;
        }
        canvas { display: block; width: 100%; height: 100%; }
        
        #ui { position: absolute; top: 10px; left: 0; width: 100%; text-align: center; color: #f57f17; font-size: 26px; font-weight: bold; pointer-events: none; text-shadow: 1px 1px 0px white; z-index: 20; }
        
        #startScreen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50;
            padding: 20px 0;
        }

        #menuHeader { text-align: center; margin-bottom: 5px; }
        #menuTitle { color: #ff9800; margin: 0; font-size: 24px; }
        #best-info { font-weight: bold; color: #f57f17; font-size: 16px; margin: 0; }
        
        /* ‰∏≠Â§ÆÂ∫ÉÂëä */
        #ad-middle-container { 
            width: 320px; height: 100px; background: #eee; margin: 15px 0; 
            display: none; justify-content: center; align-items: center; 
            overflow: hidden; flex-shrink: 0; border: 1px solid #ddd;
            transition: opacity 0.3s;
        }

        .btn-group { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 12px; }
        #goButton { padding: 15px 0; font-size: 20px; background: #ff9800; border: none; border-radius: 50px; color: white; font-weight: bold; cursor: pointer; width: 240px; box-shadow: 0 4px #e65100; transition: 0.2s; }
        #goButton:disabled { background: #ccc; box-shadow: none; color: #888; }
        .link-btn { padding: 12px 0; font-size: 16px; background: #9b59b6; border: none; border-radius: 50px; color: white; font-weight: bold; text-decoration: none; width: 240px; text-align: center; box-shadow: 0 4px #8e44ad; }

        /* Â§ßÂ∫ÉÂëäÁî® */
        #bigAdScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; display: none; justify-content: center; align-items: center; }
        .ad-frame-wrapper { width: 95%; height: 85%; position: relative; }
        .ad-close-btn { position: absolute; top: -15px; right: -15px; color: white; font-size: 22px; font-weight: bold; cursor: pointer; background: rgba(0,0,0,0.8); width: 44px; height: 44px; border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 3100; border: 2px solid white; }
    </style>
</head>
<body style="display: flex; flex-direction: column;">

    <div id="ad-top"><iframe id="frame-top" src="ad.html?pos=top"></iframe></div>

    <div id="game-outer">
        <div id="ui">SCORE: 0</div>
        <canvas id="gameCanvas"></canvas>

        <div id="startScreen">
            <div id="menuHeader">
                <h1 id="menuTitle">Bunny Jump Up</h1>
                <p id="gameDesc" style="margin: 5px 0; font-size: 14px; text-align: center;">Â∑¶Âè≥„Çø„ÉÉ„Éó„Åß„Ç∏„É£„É≥„ÉóÔºÅ<br>„Å©„Çì„Å©„ÇìÈ´ò„ÅèÁôª„Å£„Å¶„ÅÑ„Åì„ÅÜÔºÅüê∞ü•ï</p>
                <p id="best-info">BEST: <span id="best-ui">0</span></p>
            </div>
            
            <div id="ad-middle-container">
                <div id="im-8b492cea6667490da71c488bdcc7cfc8">
                    <script async src="https://imp-adedge.i-mobile.co.jp/script/v1/spot.js?20220104"></script>
                    <script>(window.adsbyimobile=window.adsbyimobile||[]).push({pid:84561,mid:590804,asid:1924211,type:"banner",display:"inline",elementid:"im-8b492cea6667490da71c488bdcc7cfc8"})</script>
                </div>
            </div>

            <div class="btn-group">
                <button id="goButton">„Çπ„Çø„Éº„ÉàÔºÅ</button>
                <a href="jump.html" class="link-btn">ÈÅä„Å≥Êñπ„Éª„Ç≥„ÉÑ</a>
            </div>
        </div>

        <div id="bigAdScreen">
            <div class="ad-frame-wrapper">
                <div id="ad-close-btn" class="ad-close-btn" onclick="closeBigAd()"></div>
                <iframe id="ad-large-frame" src="" style="width:100%; height:100%; border:none;"></iframe>
            </div>
        </div>
    </div>

    <div id="ad-bottom"><iframe id="frame-bottom" src="ad.html?pos=bottom"></iframe></div>

    <script>
        const canvas = document.getElementById("gameCanvas"), ctx = canvas.getContext("2d"), ui = document.getElementById("ui"), startScreen = document.getElementById("startScreen"), menuTitle = document.getElementById("menuTitle"), gameDesc = document.getElementById("gameDesc"), adMid = document.getElementById("ad-middle-container"), goButton = document.getElementById("goButton"), bestUi = document.getElementById("best-ui"), gameOuter = document.getElementById("game-outer");

        function resize() { canvas.width = gameOuter.clientWidth; canvas.height = gameOuter.clientHeight; }
        window.addEventListener('resize', resize);
        resize();

        let score = 0, bestScore = localStorage.getItem("bunny_jump_best") || 0, playCount = 0;
        let gameActive = false, platforms = [], cameraY = 0, player = { x: 0, y: 0, vy: 0 };
        bestUi.innerText = bestScore;

        function initPlatforms() {
            platforms = [];
            let firstY = canvas.height - 100; 
            platforms.push({ x: canvas.width/2 - 50, y: firstY, w: 100 });
            for(let i=1; i<15; i++) { addPlatform(firstY - (i * 100)); }
        }

        function addPlatform(y) { platforms.push({ x: Math.random() * (canvas.width - 80), y: y, w: 80 }); }

        goButton.onclick = () => {
            startScreen.style.display = "none"; adMid.style.display = "none";
            gameActive = true; score = 0; cameraY = 0; ui.innerText = "SCORE: 0";
            resize(); 
            player.x = canvas.width/2; player.y = canvas.height - 180; player.vy = 0;
            initPlatforms(); update();
        };

        window.addEventListener("touchstart", (e) => {
            if(!gameActive) return;
            const rect = canvas.getBoundingClientRect();
            const touchX = e.touches[0].clientX - rect.left;
            if(touchX < canvas.width/2) player.x -= 35;
            else player.x += 35;
            e.preventDefault();
        }, {passive: false});

        function update() {
            if(!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            player.vy += 0.4; player.y += player.vy;

            if (player.y < cameraY + canvas.height / 3) {
                let diff = (cameraY + canvas.height / 3) - player.y;
                cameraY -= diff;
                if (platforms[platforms.length - 1].y > cameraY - 100) { addPlatform(platforms[platforms.length - 1].y - 100); }
            }

            ctx.fillStyle = "#8bc34a";
            platforms.forEach((p) => {
                let drawY = p.y - cameraY;
                if(drawY > -50 && drawY < canvas.height + 100) { ctx.fillRect(p.x, drawY, p.w, 15); }
                if (player.vy > 0 && player.x > p.x - 25 && player.x < p.x + p.w + 25 && player.y > p.y - 10 && player.y < p.y + 15) {
                    player.vy = -13;
                    let currentScore = Math.floor((canvas.height - p.y) / 10);
                    if (currentScore > score) { score = currentScore; ui.innerText = "SCORE: " + score; }
                }
            });

            ctx.font = "50px Arial"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
            ctx.fillText("üê∞", player.x, player.y - cameraY);

            if (player.y - cameraY > canvas.height) { gameOver(); return; }
            if (player.x < 0) player.x = canvas.width;
            if (player.x > canvas.width) player.x = 0;
            requestAnimationFrame(update);
        }

        function gameOver() {
            gameActive = false; playCount++;
            if (score > bestScore) { bestScore = score; localStorage.setItem("bunny_jump_best", bestScore); bestUi.innerText = bestScore; }
            
            goButton.innerText = "„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ..."; goButton.disabled = true;
            adMid.style.display = "flex"; adMid.style.opacity = "0.4";
            menuTitle.innerText = "GAME OVER";
            gameDesc.style.display = "none";
            startScreen.style.display = "flex";

            setTimeout(() => { adMid.style.opacity = "1"; goButton.disabled = false; goButton.innerText = "„É™„Éà„É©„Ç§ÔºÅ"; }, 1500);
            if (playCount === 3 || (playCount > 3 && (playCount - 3) % 7 === 0)) { setTimeout(showBigAd, 500); }
        }

        function showBigAd() {
            const screen = document.getElementById("bigAdScreen"), closeBtn = document.getElementById("ad-close-btn");
            document.getElementById("ad-large-frame").src = "./ad.large.html?t=" + Date.now();
            screen.style.display = "flex"; let countdown = 5; closeBtn.style.display = "flex"; closeBtn.innerText = countdown; closeBtn.style.pointerEvents = "none";
            const timerInt = setInterval(() => { countdown--; closeBtn.innerText = countdown; if (countdown <= 0) { clearInterval(timerInt); closeBtn.innerText = "√ó"; closeBtn.style.pointerEvents = "auto"; } }, 1000);
        }

        function closeBigAd() { document.getElementById("bigAdScreen").style.display = "none"; document.getElementById("ad-large-frame").src = ""; }

        setInterval(() => { const f = document.getElementById('frame-top'); if(f) f.src = "ad.html?pos=top&t=" + Date.now(); }, 30000);
        setTimeout(() => { setInterval(() => { const f = document.getElementById('frame-bottom'); if(f) f.src = "ad.html?pos=bottom&t=" + Date.now(); }, 30000); }, 15000);
    </script>
</body>
</html>
